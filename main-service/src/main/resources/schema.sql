DROP TABLE IF EXISTS CATEGORIES CASCADE;
DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS EVENTS CASCADE;
DROP TABLE IF EXISTS LOCATIONS CASCADE;
DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS REQUESTS CASCADE;


CREATE TABLE IF NOT EXISTS CATEGORIES
(
    ID   BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME VARCHAR(50)                             NOT NULL UNIQUE,
    CONSTRAINT CATEGORIES_PK PRIMARY KEY (ID)
);
CREATE TABLE IF NOT EXISTS USERS
(
    ID    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    EMAIL VARCHAR(254)                            NOT NULL UNIQUE,
    NAME  VARCHAR(250)                            NOT NULL,
    CONSTRAINT USERS_PK PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS LOCATIONS
(
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    LAT FLOAT,
    LON FLOAT,
    CONSTRAINT LOCATIONS_PK PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS EVENTS
(
    ID                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    TITLE              VARCHAR(120)                            NOT NULL,
    ANNOTATION         VARCHAR(2000)                           NOT NULL,
    CATEGORY_ID        BIGINT,
    DESCRIPTION        VARCHAR(7000)                           NOT NULL,
    EVENT_DATE         TIMESTAMP,
    LOCATION           BIGINT,
    PAID               BOOLEAN,
    PARTICIPANT_LIMIT  INT,
    REQUEST_MODERATION BOOLEAN,
    CREATED_ON         TIMESTAMP,
    PUBLISHED_ON       TIMESTAMP,
    INITIATOR          BIGINT,
    STATE              VARCHAR(10),
    VIEWS              BIGINT,
    CONSTRAINT EVENTS_PK PRIMARY KEY (ID),
    CONSTRAINT EVENTS_CATEGORY_FK FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORIES (ID) ON DELETE CASCADE,
    CONSTRAINT EVENTS_USER_FK FOREIGN KEY (INITIATOR) REFERENCES USERS (ID) ON DELETE CASCADE,
    CONSTRAINT EVENTS_LOCATION_FK FOREIGN KEY (LOCATION) REFERENCES LOCATIONS (ID) ON DELETE CASCADE

);
CREATE TABLE IF NOT EXISTS USERS
(
    ID    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    EMAIL VARCHAR,
    NAME  VARCHAR,
    CONSTRAINT USER_PK PRIMARY KEY (ID)
);


CREATE TABLE IF NOT EXISTS REQUESTS
(
    ID        BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    CREATED   TIMESTAMP,
    EVENT     BIGINT,
    REQUESTER BIGINT,
    STATUS    VARCHAR,
    CONSTRAINT REQUEST_PK PRIMARY KEY (ID),
    CONSTRAINT REQUESTS_EVENTS_FK FOREIGN KEY (EVENT) REFERENCES EVENTS (ID) ON DELETE CASCADE,
    CONSTRAINT REQUESTS_USERS_FK FOREIGN KEY (REQUESTER) REFERENCES USERS (ID) ON DELETE CASCADE

);

CREATE TABLE IF NOT EXISTS COMPILATIONS
(
    ID     BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PINNED BOOLEAN,
    TITLE  VARCHAR(50),
    CONSTRAINT COMPILATION_PK PRIMARY KEY (ID)

);


CREATE TABLE IF NOT EXISTS COMPILATIONS_EVENTS
(
    COMPILATION_ID BIGINT,
    EVENT_ID       BIGINT,
    CONSTRAINT COMPILATIONS_EVENTS_EVENTS_FK FOREIGN KEY (EVENT_ID) REFERENCES EVENTS (ID) ON DELETE CASCADE,
    CONSTRAINT COMPILATIONS_EVENTS_COMPILATIONS_FK FOREIGN KEY (COMPILATION_ID) REFERENCES COMPILATIONS (ID) ON DELETE CASCADE
);




